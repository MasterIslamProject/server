{"version":3,"sources":["../../src/quit/quit-endpoint.js"],"names":["makeQuitEndpointHandler","quitQuery","handle","httpRequest","method","postQuit","getQuit","deleteQuit","statusCode","errorMessage","id","queryParams","max","before","after","undefined","result","findById","headers","data","JSON","stringify","quitInfo","body","parse","quit","add","e","message","UniqueConstraintError","InvalidPropertyError","RequiredParameterError","pathParams","deleteById"],"mappings":"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","sourcesContent":["import {\n    UniqueConstraintError,\n    InvalidPropertyError,\n    RequiredParameterError\n  } from '../helpers/errors';\n  import makeHttpError from '../helpers/http-error';\n  import makeQuit from './quit';\n\nexport default function makeQuitEndpointHandler({quitQuery}){\n    return async function handle(httpRequest){\n        switch (httpRequest.method) {\n            case 'POST':\n              return postQuit(httpRequest)\n      \n            case 'GET':\n              return getQuit(httpRequest)\n\n            case 'DELETE':\n              return deleteQuit(httpRequest)\n\n            default:\n              return makeHttpError({\n                statusCode: 405,\n                errorMessage: `${httpRequest.method} method not allowed.`\n              })\n        }\n    }\n\n    async function getQuit (httpRequest) {\n      const { id } = httpRequest.queryParams || {}\n      const { max, before, after } = httpRequest.queryParams || {}\n\n      if (id !== undefined ){\n        const result = await quitQuery.findById({ id })\n\n        return {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          statusCode: 200,\n          data: JSON.stringify(result)\n        }\n\n      }\n      else {\n      \n        const result = await quitQuery.getQuit({ max, before, after })\n\n        return {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          statusCode: 200,\n          data: JSON.stringify(result)\n        }\n        \n      }\n        \n    }\n\n\n    async function postQuit (httpRequest) {\n      \n        let quitInfo = httpRequest.body\n        \n        if (!quitInfo) {\n          return makeHttpError({\n            statusCode: 400,\n            errorMessage: 'Bad request. No POST body.'\n          })\n        }\n    \n        if (typeof httpRequest.body === 'string') {\n          try {\n            quitInfo = JSON.parse(quitInfo)\n          } catch {\n            return makeHttpError({\n              statusCode: 400,\n              errorMessage: 'Bad request. POST body must be valid JSON.'\n            })\n          }\n        }\n    \n        try {\n          const quit = makeQuit(quitInfo)\n          const result = await quitQuery.add(quit)\n          return {\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            statusCode: 201,\n            data: JSON.stringify(result)\n          }\n        } catch (e) {\n          return makeHttpError({\n            errorMessage: e.message,\n            statusCode:\n              e instanceof UniqueConstraintError\n                ? 409\n                : e instanceof InvalidPropertyError ||\n                  e instanceof RequiredParameterError\n                  ? 400\n                  : 500\n          })\n        }\n    }\n\n \n  async function deleteQuit (httpRequest) {\n    const { id } = httpRequest.pathParams || {}\n    \n    try {\n      const result = await quitQuery.deleteById({ id })\n\n      return {\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        statusCode: 200,\n        data: JSON.stringify(result)\n      }\n    }\n    catch (e){\n      return makeHttpError({\n        errorMessage: e.message,\n        statusCode:\n          e instanceof UniqueConstraintError\n            ? 409\n            : e instanceof InvalidPropertyError ||\n              e instanceof RequiredParameterError\n              ? 400\n              : 500\n      })\n\n    }\n    \n  }\n\n\n}"],"file":"quit-endpoint.js"}