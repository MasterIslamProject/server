{"version":3,"sources":["../../src/trending-react/trending-react-query.js"],"names":["makeTrendingReactQuery","database","Object","freeze","add","verify","updateMentor","updateMentorPicture","updateMentorPassword","findById","findByCategory","findByTrendingId","findByMentorId","getTrendingReact","deleteByTrendingId","deleteById","update","max","before","after","db","query","_id","$lt","makeId","$gt","collection","find","limit","Number","toArray","map","documentToTrendingReact","trendingReactId","trendingReact","insertOne","then","result","status","message","insertedId","catch","mongoError","errorCode","split","_","mongoIndex","UniqueConstraintError","trendingReactInfo","found","findOne","trending_id","mentor_id","id","newSet","$set","mentor_lastname","mentor_othernames","description","picture","category","video","type","caption","password","date","updateOne","upsert","updateMany","n","old_password","bcrypt","hashSync","new_password","deleteMany","success","deleteOne","doc"],"mappings":"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","sourcesContent":["import makeTrendingReact from './trending-react'\nimport { UniqueConstraintError } from '../helpers/errors'\n\nexport default function makeTrendingReactQuery({database}){\n    return Object.freeze({\n        add,\n        verify,\n        updateMentor,\n        updateMentorPicture,\n        updateMentorPassword,\n        findById,\n        findByCategory,\n        findByTrendingId,\n        findByMentorId,\n        getTrendingReact,\n        deleteByTrendingId,\n        deleteById,\n        update\n    });\n\n    async function getTrendingReact ({ max = 100, before, after } = {}) {\n        const db = await database;\n        const query = {}\n        if (before || after) {\n        query._id = {}\n        query._id = before ? { ...query._id, $lt: db.makeId(before) } : query._id\n        query._id = after ? { ...query._id, $gt: db.makeId(after) } : query._id\n        }\n\n        return (await db\n        .collection('TrendingReact')\n        .find(query)\n        .limit(Number(max))\n        .toArray()).map(documentToTrendingReact)\n    }\n\n\n    async function add ({ trendingReactId, ...trendingReact }) {\n      \n        const db = await database\n        if (trendingReactId) {\n          trendingReact._id = db.makeId(trendingReactId)\n        }\n\n        return db.collection(\"TrendingReact\")\n          .insertOne(trendingReact)\n          .then(result => {\n            //console.log(result.insertedId);\n            return {\n              // success: result.ok === 1,\n              // id: result.insertedId\n              status: \"success\",\n              message: result.insertedId\n            }\n        }).catch(mongoError => {\n          const [errorCode] = mongoError.message.split(' ')\n              if (errorCode === 'E11000') {\n                const [_, mongoIndex] = mongoError.message.split(':')[2].split(' ')\n                throw new UniqueConstraintError(\n                  mongoIndex === 'ContactEmailIndex' ? 'emailAddress' : 'contactId'\n                )\n              }\n              throw mongoError\n        });\n        \n    }\n\n    async function verify ({ trendingReactInfo }) {\n      \n      const db = await database\n      const found = await db\n        .collection('TrendingReact')\n        .findOne({ trending_id: trendingReactInfo.trending_id, mentor_id: trendingReactInfo.mentor_id })\n      \n\n      if (found) {\n        return {\n          message: \"Success\",\n          status: \"Found\"\n        };\n      }\n      else {\n          return {\n            message: \"Error\",\n            status :\"Null\"\n          }\n      }\n      \n    }\n\n  async function update ({ id, ...trendingReact }) {\n      \n      const db = await database\n      const query = {\n        _id: db.makeId(id)\n      }\n\n      const newSet = {\n        $set : {\n          trending_id: trendingReact.trending_id,\n          mentor_id: trendingReact.mentor_id,\n          mentor_lastname: trendingReact.mentor_lastname,\n          mentor_othernames: trendingReact.mentor_othernames,\n          description: trendingReact.description,\n          picture: trendingReact.picture,\n          category: trendingReact.category,\n          video: trendingReact.video,\n          type: trendingReact.type,\n          caption: trendingReact.caption,\n          password: trendingReact.password,\n          date: trendingReact.date,\n        } \n      }\n\n      const { result } = await db\n        .collection('TrendingReact')\n        .updateOne(query, newSet, {upsert:true})\n\n        if (result) {\n          return {\n            status: \"success\",\n            message: \"Updated successfully\"\n          }\n        }\n        else {\n          return {\n            status: \"error\",\n            message: \"Error updating\"\n          }\n        }\n      \n  }\n\n  async function updateMentor ({ password, ...trendingReact }) {\n      \n    const db = await database\n    const query = {\n      password: password\n    }\n\n    const newSet = {\n      $set : {\n        mentor_lastname: trendingReact.mentor_lastname,\n        mentor_othernames: trendingReact.mentor_othernames\n      } \n    }\n    const { result } = await db\n      .collection('TrendingReact')\n      .updateMany(query, newSet)\n\n      return {\n        status: \"success\",\n        message: result.n+\" updated\"\n      }\n    \n  }\n\n  async function updateMentorPicture ({ password, ...trendingReact }) {\n    const db = await database\n    const query = {\n      password: password\n    }\n\n    const newSet = {\n      $set : {\n        picture: trendingReact.picture\n      } \n    }\n    const { result } = await db\n      .collection('TrendingReact')\n      .updateMany(query, newSet)\n\n      return {\n        status: \"success\",\n        message: result.n+\" updated\"\n      }\n    \n  }\n\n  async function updateMentorPassword ({ old_password, ...trendingReact}) {\n    const db = await database\n\n    //oldpass = bcrypt.hashSync(old_password, 10);\n    const query = {\n      password: old_password\n    }\n    \n    // const newSet = {\n    //   $set : {\n    //     password: bcrypt.hashSync(trendingReact.new_password, 10)\n    //   } \n    // }\n    const { result } = await db\n      .collection('TrendingReact')\n      .updateMany(query, {\n        $set : {\n          password: bcrypt.hashSync(trendingReact.new_password, 10)\n        } \n      })\n\n      return {\n        status: \"success\",\n        message: result.n+\" updated\"\n      }\n  }\n\n    \n  async function findById ({ id }) {\n    \n    const db = await database\n    const found = await db\n      .collection('TrendingReact')\n      .findOne({ _id: db.makeId(id) })\n    if (found) {\n      return documentToTrendingReact(found)\n    }\n    return {}\n  }\n\n  async function findByCategory({ category }) {\n    const db = await database;\n    \n    return (await db\n      .collection('TrendingReact')\n      .find({ category: category })\n      .toArray()).map(documentToTrendingReact)\n  }\n\n  async function findByTrendingId({ trending_id }) {\n    const db = await database;\n    \n    return (await db\n      .collection('TrendingReact')\n      .find({ trending_id: trending_id })\n      .toArray()).map(documentToTrendingReact)\n  }\n\n  async function findByMentorId({ mentor_id }) {\n    const db = await database;\n    \n    return (await db\n      .collection('TrendingReact')\n      .find({ mentor_id: mentor_id })\n      .toArray()).map(documentToTrendingReact)\n  }\n\n  async function deleteByTrendingId ({ trending_id }) {\n    const db = await database\n\n    const { result } = await db.collection('TrendingReact').deleteMany({\"trending_id\": trending_id})\n    return {\n      success: result.n\n    }\n  }  \n\n\n  async function deleteById ({ id }) {\n    const db = await database\n\n    const { result } = await db.collection('TrendingReact').deleteOne({\"_id\": db.makeId(id)})\n    if (result.n > 0){\n      return {\n        status: \"Success\"\n      }\n    }\n    else {\n      return {\n        status: \"Error\"\n      }\n    }\n  }\n\n  function documentToTrendingReact ({ _id: id, ...doc }) {\n    return makeTrendingReact({ id, ...doc })\n  }\n}"],"file":"trending-react-query.js"}