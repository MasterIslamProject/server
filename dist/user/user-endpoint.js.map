{"version":3,"sources":["../../src/user/user-endpoint.js"],"names":["makeUserEndpointHandler","userQuery","handle","httpRequest","method","postUser","getUser","deleteUser","statusCode","errorMessage","id","queryParams","email","verifyemail","category","max","before","after","undefined","result","findByEmail","headers","data","JSON","stringify","findVerifyEmail","findByCategory","findById","userInfo","body","parse","path","user","auth","verify","reset","resetPassword","add","e","message","UniqueConstraintError","InvalidPropertyError","RequiredParameterError","pathParams","deleteById"],"mappings":"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","sourcesContent":["import {\n    UniqueConstraintError,\n    InvalidPropertyError,\n    RequiredParameterError\n  } from '../helpers/errors';\n  import makeHttpError from '../helpers/http-error';\n  import makeUser from './user';\n\nexport default function makeUserEndpointHandler({userQuery}){\n    return async function handle(httpRequest){\n        switch (httpRequest.method) {\n            case 'POST':\n              return postUser(httpRequest)\n      \n            case 'GET':\n              return getUser(httpRequest)\n          \n            case 'DELETE':\n              return deleteUser(httpRequest)\n\n            default:\n              return makeHttpError({\n                statusCode: 405,\n                errorMessage: `${httpRequest.method} method not allowed.`\n              })\n        }\n    }\n\n    async function getUser (httpRequest) {\n\n      const { id } = httpRequest.queryParams || {}\n      const { email } = httpRequest.queryParams || {}\n      const { verifyemail } = httpRequest.queryParams || {}\n      const { category } = httpRequest.queryParams || {}\n      const { max, before, after } = httpRequest.queryParams || {}\n\n      if (email !== undefined){\n        const result = await userQuery.findByEmail({ email })\n\n        return {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          statusCode: 200,\n          data: JSON.stringify(result)\n        }\n\n      }\n      if (verifyemail !== undefined){\n        const result = await userQuery.findVerifyEmail({ verifyemail })\n\n        return {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          statusCode: 200,\n          data: JSON.stringify(result)\n        }\n\n      }\n      else if (category !== undefined){\n        const result = await userQuery.findByCategory({ category })\n\n        return {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          statusCode: 200,\n          data: JSON.stringify(result)\n        }\n\n      }\n      else if (id !== undefined ){\n        const result = await userQuery.findById({ id })\n\n        return {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          statusCode: 200,\n          data: JSON.stringify(result)\n        }\n\n      }\n      else {\n        const result = await userQuery.getUser({ max, before, after })\n\n        return {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          statusCode: 200,\n          data: JSON.stringify(result)\n        }\n        \n      }\n\n    }\n\n    async function postUser (httpRequest) {\n      \n        let userInfo = httpRequest.body\n        if (!userInfo) {\n          return makeHttpError({\n            statusCode: 400,\n            errorMessage: 'Bad request. No POST body.'\n          })\n        }\n    \n        if (typeof httpRequest.body === 'string') {\n          try {\n            userInfo = JSON.parse(userInfo)\n          } catch {\n            return makeHttpError({\n              statusCode: 400,\n              errorMessage: 'Bad request. POST body must be valid JSON.'\n            })\n          }\n        }\n    \n        try { \n           \n          if (httpRequest.path == '/user/auth'){\n            \n            const user = makeUser(userInfo);\n            const result = await userQuery.auth(user);\n            return {\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                statusCode: 201,\n                data: JSON.stringify(result)\n              }\n          }\n          else if (httpRequest.path == '/user/verify'){\n            const result = await userQuery.verify(userInfo);\n            return {\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                statusCode: 201,\n                data: JSON.stringify(result)\n              }\n          }\n          else if (httpRequest.path == '/user/reset'){\n            const user = makeUser(userInfo);\n            const result = await userQuery.reset(user);\n            \n            return {\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                statusCode: 201,\n                data: JSON.stringify(result)\n              }\n          }\n          \n          else if (httpRequest.path == '/user/reset_password'){\n          \n            const user = makeUser(userInfo);\n            const result = await userQuery.resetPassword(user);\n            \n            return {\n              headers: {\n                'Content-Type': 'application/json'\n              },\n              statusCode: 201,\n              data: JSON.stringify(result)\n            }\n          }\n          else {\n            const user = makeUser(userInfo);\n            const result = await userQuery.add(user);\n            return {\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                statusCode: 201,\n                data: JSON.stringify(result)\n              }\n          }\n          \n          \n        } catch (e) {\n          return makeHttpError({\n            errorMessage: e.message,\n            statusCode:\n              e instanceof UniqueConstraintError\n                ? 409\n                : e instanceof InvalidPropertyError ||\n                  e instanceof RequiredParameterError\n                  ? 400\n                  : 500\n          })\n        }\n    }\n\n    async function deleteUser (httpRequest) {\n      //const { customer_id } = httpRequest.pathParams || {}\n      const { id } = httpRequest.pathParams || {}\n      try {\n        const result = await userQuery.deleteById({ id })\n  \n        return {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          statusCode: 200,\n          data: JSON.stringify(result)\n        }\n      }\n      catch (e){\n        return makeHttpError({\n          errorMessage: e.message,\n          statusCode:\n            e instanceof UniqueConstraintError\n              ? 409\n              : e instanceof InvalidPropertyError ||\n                e instanceof RequiredParameterError\n                ? 400\n                : 500\n        })\n  \n      }\n      \n    }\n\n}"],"file":"user-endpoint.js"}